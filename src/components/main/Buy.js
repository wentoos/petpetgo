import React, { Component } from 'react';
import '../../css/buy.css'
import { connect } from 'react-redux'
import Modal from 'antd/lib/modal'
let icon=<svg  width="10vw" height="10vw" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path fill="#d81e06" d="M255.104 750.848c-40.256 0-73.088 33.664-73.088 75.136 0 41.472 32.832 75.328 73.088 75.328s73.088-33.792 73.088-75.328C328.192 784.576 295.36 750.848 255.104 750.848zM255.104 876.096c-26.432 0-47.936-22.464-47.936-50.112 0-27.584 21.504-50.048 47.936-50.048 26.368 0 47.872 22.528 47.872 50.048C302.976 853.696 281.472 876.096 255.104 876.096zM688.512 750.848c-40.256 0-73.024 33.664-73.024 75.136 0 41.472 32.768 75.328 73.024 75.328 40.32 0 73.088-33.792 73.088-75.328C761.536 784.576 728.832 750.848 688.512 750.848zM688.512 876.096c-26.432 0-47.872-22.464-47.872-50.112 0-27.584 21.44-50.048 47.872-50.048 26.368 0 47.936 22.528 47.936 50.048C736.448 853.696 714.88 876.096 688.512 876.096zM947.456 122.688l-94.272 0c-1.088 0-1.984 0.384-2.88 0.576-1.024-0.192-1.984-0.576-2.944-0.576-21.44 0-38.72 17.344-38.656 37.504l-52.352 521.856c0 7.488-6.144 13.696-13.696 13.696L197.824 695.744c-18.816 0-34.112-15.296-34.112-34.176 0-18.816 15.296-34.112 34.112-34.112 0.448 0 0.704-0.192 1.152-0.192 0.384 0 0.832 0.192 1.216 0.192l427.968 0c32.704 0 59.264-26.56 59.264-59.264 0-30.976-24.32-52.608-59.264-52.608L163.776 515.136c-18.816 0-34.176-15.296-34.176-34.048 0-18.944 15.36-34.24 34.112-34.24l493.568 1.728c33.792 0 61.312-25.664 61.312-57.28 0-31.744-24.896-54.784-59.264-54.784L123.264 336.384c-18.816 0-34.112-15.296-34.112-34.112 0-18.88 15.296-34.112 34.112-34.112l595.264 0c6.912 0 12.48-5.632 12.48-12.608 0-6.848-5.568-12.544-12.48-12.544L123.264 243.008C90.624 242.944 64 269.632 64 302.272c0 32.704 26.624 59.264 59.264 59.264l536.064 0.128c16.512 0 34.112 9.344 34.112 29.696 0 17.664-16.192 32.128-36.096 32.128L163.776 421.76c-32.768 0-59.328 26.624-59.328 59.328s26.56 59.264 59.328 59.264l464.32 0.384c16.512 0 34.112 7.232 34.112 27.52 0 18.816-15.296 34.048-34.112 34.048L200.128 602.304c-0.384 0-0.832 0.256-1.216 0.256-0.448 0-0.704-0.256-1.152-0.256-32.704 0-59.328 26.688-59.328 59.328 0 32.704 26.624 59.392 59.328 59.392l544.832 0c21.376 0 38.784-17.408 38.72-37.568l52.352-521.856c0-7.552 6.144-13.696 13.632-13.696 0.96 0 1.92-0.32 2.944-0.576C851.2 147.52 852.096 147.84 853.184 147.84l94.272 0C954.368 147.84 960 142.272 960 135.232 960 128.32 954.368 122.688 947.456 122.688z" /></svg>
class Buy extends Component {
    constructor(){
        super()
        this.state = { visible: false }
    }
        showModal(){
            if(sessionStorage.userId){
                this.props.push.history.push('/buys')
            }else {
                this.setState({
                  visible: true,
                })
            }

        }
        handleOk(){
            this.setState({
              visible: false,
            })
            this.props.push.history.push('/login')
        }
        handleCancel(){
            this.setState({
              visible: false,
            });
        }
        render() {
            console.log(this.props);
            let nums=0
            this.props.buy.map(item=> item.num*item.price).forEach(item=>{
                nums+=item
            })

            return (
              <div className='main_buy'>
                  <i>{this.props.buy.length}</i>
                  <p>
                      {icon}
                      <span>{nums?'￥'+nums:'购物车是空的呦..'}</span>
                  </p>
                  {this.props.buy.length>0?<a onClick={this.showModal.bind(this)}>去结算</a>:<b>￥15起送</b>}
                  <Modal
                      title="提示"
                      visible={this.state.visible}
                      onOk={this.handleOk.bind(this)}
                      onCancel={this.handleCancel.bind(this)}
                  >
                      <p>请先登录偶...</p>
                  </Modal>
              </div>
            )
        }
}


let mapStateToProps = state => ({
    buy:state.buy
})
export default connect(mapStateToProps)(Buy)
